<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard D3.js -  By Janeth Valdivia</title>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            margin: 0;
        }
        .dashboard {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
            color: #2c3e50;
        }
        .header h1 {
            font-size: 2.5em;
            background: linear-gradient(45deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        .header h2 {
            font-weight: normal;
            color: #555;
        }
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 25px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
            margin-bottom: 30px;
        }
        svg {
            display: block;
            margin: auto;
            background: #f0f0f0;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>Proyecto Final: Visualizaciones D3.js</h1>
            <h2>Janeth Valdivia</h2>
        </div>

        <div class="chart-container">
            <h2>Visualización 1: Coordenadas en Tiempo Real con Cuadrícula</h2>
            <svg id="coords" width="400" height="400"></svg>
        </div>

        <div class="chart-container">
            <h2>Visualización 2: Interactive Brush Visualization</h2>
            <svg id="brush1" width="400" height="400"></svg>
            <svg id="brush2" width="400" height="400"></svg>
        </div>

        <div class="chart-container">
            <h2>Visualización 3: Drag & Drop</h2>
            <svg id="dragdrop" width="600" height="300"></svg>
        </div>

        <div class="chart-container">
            <h2>Visualización 4: Stagger Transition</h2>
            <svg id="stagger" width="600" height="400"></svg>
        </div>

        <div class="chart-container">
            <h2>Visualización 5: Animación de Lissajous</h2>
            <svg id="lissajous" width="400" height="400"></svg>
        </div>
    </div>

<script>
// Visualización 1: Coordenadas con cuadrícula
function coordsPixels() {
  var svg = d3.select('#coords')
      .attr('cursor', 'crosshair');
  var txt = svg.append('text').attr("fill", "black").attr("font-size", "14px");

  // Agregamos cuadrícula
  var gridSize = 50;
  for (var x = 0; x <= 400; x += gridSize) {
    svg.append("line")
      .attr("x1", x).attr("y1", 0)
      .attr("x2", x).attr("y2", 400)
      .attr("stroke", "#ccc");
  }
  for (var y = 0; y <= 400; y += gridSize) {
    svg.append("line")
      .attr("x1", 0).attr("y1", y)
      .attr("x2", 400).attr("y2", y)
      .attr("stroke", "#ccc");
  }

  svg.on('mousemove', function() {
    var pt = d3.mouse(this);
    txt.attr('x', 10+pt[0]).attr('y', 10+pt[1])
      .text(pt[0].toFixed(0) + ',' + pt[1].toFixed(0));
  });
}
coordsPixels();

// Visualización 2: Brush con parseo correcto
function makeBrush() {
  d3.csv("dense.csv", function(d) {
    return { A: +d.A, B: +d.B };  // Convertimos a números
  }).then(function(data) {
    var svg1 = d3.select("#brush1"), svg2 = d3.select("#brush2");
    var sc1 = d3.scaleLinear().domain([0, 400]).range(["lime", "yellow", "red"]);
    var sc2 = d3.scaleLinear().domain([0, 400]).range(["lime", "yellow", "blue"]);

    var cs1 = drawCircles(svg1, data, d => d.A, d => d.B, sc1);
    var cs2 = drawCircles(svg2, data, d => d.A, d => d.B, sc2);
    svg1.call(installHandlers, data, cs1, cs2, sc1, sc2);
  });

  function drawCircles(svg, data, accX, accY, sc) {
    return svg.selectAll("circle")
      .data(data)
      .enter()
      .append("circle")
      .attr("r", 5)
      .attr("cx", d => accX(d))
      .attr("cy", d => accY(d))
      .attr("fill", sc(Infinity))
      .attr("fill-opacity", 0.4);
  }

  function installHandlers(svg, data, cs1, cs2, sc1, sc2) {
    svg.attr("cursor", "crosshair").on("mousemove", function() {
      var pt = d3.mouse(this);
      cs1.attr("fill", function(d, i) {
        var r = Math.hypot(pt[0] - d.A, pt[1] - d.B);
        data[i].r = r;
        return sc1(r);
      });
      cs2.attr("fill", function(d, i) { return sc2(data[i].r); });
    }).on("mouseleave", function() {
      cs1.attr("fill", sc1(Infinity));
      cs2.attr("fill", sc2(Infinity));
    });
  }
}
makeBrush();

// Visualización 3: Drag & Drop
function makeDragDrop() {
  var widget, color;
  var drag = d3.drag()
    .on("start", function() {
      color = d3.select(this).attr("fill");
      widget = d3.select(this).attr("fill", "lime");
    })
    .on("drag", function() {
      var pt = d3.mouse(this);
      widget.attr("cx", pt[0]).attr("cy", pt[1]);
    })
    .on("end", function() {
      widget.attr("fill", color);
    });
  drag(d3.select("#dragdrop").selectAll("circle"));
}

var svgDrag = d3.select("#dragdrop");
svgDrag.append("circle").attr("cx", 100).attr("cy", 150).attr("r", 30).attr("fill", "red");
svgDrag.append("circle").attr("cx", 300).attr("cy", 150).attr("r", 30).attr("fill", "green");
svgDrag.append("circle").attr("cx", 500).attr("cy", 150).attr("r", 30).attr("fill", "blue");
makeDragDrop();

// Visualización 4: Stagger
function makeStagger() {
  var ds1 = [2, 1, 3, 5, 7, 8, 9, 9, 9, 8, 7, 5, 3, 1, 2];
  var ds2 = [8, 9, 8, 7, 5, 3, 2, 1, 2, 3, 5, 7, 8, 9, 8];
  var n = ds1.length;
  var mx = d3.max(ds1.concat(ds2));
  var svg = d3.select("#stagger");
  var scX = d3.scaleLinear().domain([0,n]).range([50,540]);
  var scY = d3.scaleLinear().domain([0,mx]).range([350,50]);
  svg.selectAll("line").data(ds1).enter().append("line")
    .attr("stroke", "red").attr("stroke-width", 20)
    .attr("x1", (d,i)=>scX(i)).attr("y1", scY(0))
    .attr("x2", (d,i)=>scX(i)).attr("y2", d=>scY(d));
  svg.on("click", function() {
    [ ds1, ds2 ] = [ ds2, ds1 ];
    svg.selectAll("line").data(ds1).transition().duration(1000)
      .delay((d,i)=>200*i).attr("y2", d=>scY(d));
  });
}
makeStagger();

// Visualización 5: Lissajous
function makeLissajous() {
  var svg = d3.select("#lissajous");
  var a = 1.9, b = 3.2, omega = 2*Math.PI/10000;
  var prvX = 200 + 100, prvY = 200;
  var timer = d3.timer(function(t) {
    var phi = omega*t;
    var crrX = 200 + 100 * Math.cos(a*phi);
    var crrY = 200 + 100 * Math.sin(b*phi);
    svg.selectAll("line")
      .each(function() { this.bogus_opacity *= 0.99; })
      .attr("stroke-opacity", function() { return this.bogus_opacity; })
      .filter(function() { return this.bogus_opacity < 0.05; })
      .remove();
    svg.append("line")
      .each(function() { this.bogus_opacity = 1.0; })
      .attr("x1", prvX).attr("y1", prvY)
      .attr("x2", crrX).attr("y2", crrY)
      .attr("stroke", "green").attr("stroke-width", 2);
    prvX = crrX;
    prvY = crrY;
    if (t > 120000) { timer.stop(); }
  });
}
makeLissajous();
</script>
</body>
</html>
